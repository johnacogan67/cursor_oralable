# Oralable MAM AI Agent Instructions

## 1. Project Context
- **Device:** Oralable MAM (PPG + Accelerometer).
- **Location:** Cheek (Masseter Muscle).
- **Primary Goal:** Detect Sleep Bruxism (Clenching/Grinding) via Hemodynamic Occlusion.
- **Vitals:** Heart Rate (Green), SpO2 (Red/IR), HRV for Sleep Staging.

## 2. Signal Processing Rules
- **Sampling Rate:** All final data MUST be resampled to exactly 50Hz (20ms intervals) using linear interpolation.
- **PPG Filtering:** Use a Butterworth bandpass (0.5-8.0 Hz) for heart rate. Use a Low-pass (<1 Hz) to extract the DC-shift (Muscle Occlusion).
- **Accelerometer:** Primary use is actigraphy and jaw vibration detection (sampling up to 100Hz, but sync with 50Hz PPG).

## 3. Reference Standards
- Follow **Peter Charlton's** Pulse Waveform Analysis (PWA) for arterial stiffness and HRV.
- Implement **Zhang et al. (2023) PPG-Net 4** morphology for classifying blood flow (Laminar, Stagnant, Turbulent).
- Use **Attia et al. (2024)** standards for 50Hz sleep staging accuracy.

## 4. Coding Constraints (Python & Swift)
- **Python:** Use Pandas for time-series. Always verify Signal-to-Noise Ratio (SNR) after filtering.
- **Swift/iOS:** Prepare models for **Core ML**. Use circular buffers (100 samples) to handle real-time 50Hz streams.
- **Validation:** Every clench detection algorithm must be cross-verified against the DC-trough depth in the IR channel.

## 5. Agent Workflow
- **Plan Mode:** When I ask for a new feature, first research the `src/` directory and propose a plan in Markdown.
- **Verification:** Always check for 'Baseline Wander' when calculating SpO2.
- **Sync:** When processing logs, look for 3 consecutive high-G spikes in the Accelerometer (Sync Taps) to anchor the start time.